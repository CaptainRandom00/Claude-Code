# Data Model: Byte Bridges Enterprise Website

**Feature**: 001-byte-bridges-enterprise
**Date**: 2025-11-07
**Database**: PostgreSQL 14+

## Overview

This document defines the complete data model for the Byte Bridges enterprise website, including entities, relationships, validation rules, and database schema.

## Entity Relationship Diagram

```
┌──────────────┐
│    users     │
└──────┬───────┘
       │
       │ 1:N (author)
       │
       ▼
┌──────────────┐         ┌────────────────────┐
│  blog_posts  │         │   case_studies     │
└──────────────┘         └────────────────────┘

┌──────────────────────┐
│ contact_submissions  │
└──────────────────────┘

┌──────────────┐
│ testimonials │
└──────────────┘

Static Data (JSON files):
- services.json
- industries.json
- technologies.json
```

## Database Entities

### 1. users

**Purpose**: Admin users who can manage blog posts and case studies

**Access Pattern**: Login authentication, author lookups

```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL,
  role VARCHAR(50) DEFAULT 'admin' CHECK (role IN ('admin')),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_login_at TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
```

**TypeScript Type**:
```typescript
interface User {
  id: number
  email: string
  passwordHash: string  // Never exposed to client
  name: string
  role: 'admin'
  createdAt: Date
  updatedAt: Date
  lastLoginAt: Date | null
}

// Client-safe version
interface UserProfile {
  id: number
  email: string
  name: string
  role: 'admin'
}
```

**Validation Rules**:
- Email: Valid email format, unique
- Password: Minimum 12 characters, hashed with bcrypt (cost 12)
- Name: 2-255 characters
- Role: Only 'admin' allowed (single role per FR-009, clarification session)

**Relationships**:
- 1:N with blog_posts (author)
- 1:N with case_studies (created by)

### 2. blog_posts

**Purpose**: Content management for blog articles and thought leadership

**Access Pattern**: List (paginated, filtered by category/tag), single post by slug, search

```sql
CREATE TABLE blog_posts (
  id SERIAL PRIMARY KEY,
  slug VARCHAR(255) UNIQUE NOT NULL,
  title VARCHAR(500) NOT NULL,
  excerpt TEXT,
  content TEXT NOT NULL,
  author_id INTEGER REFERENCES users(id) ON DELETE SET NULL,
  author_name VARCHAR(255),  -- Denormalized for display
  category VARCHAR(100),
  tags TEXT[],
  featured_image_url TEXT,
  published BOOLEAN DEFAULT false,
  published_at TIMESTAMP,
  view_count INTEGER DEFAULT 0,
  reading_time_minutes INTEGER,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  search_vector tsvector GENERATED ALWAYS AS (
    to_tsvector('english',
      COALESCE(title, '') || ' ' ||
      COALESCE(excerpt, '') || ' ' ||
      COALESCE(content, '')
    )
  ) STORED
);

CREATE INDEX idx_blog_posts_slug ON blog_posts(slug);
CREATE INDEX idx_blog_posts_published ON blog_posts(published, published_at DESC);
CREATE INDEX idx_blog_posts_category ON blog_posts(category) WHERE published = true;
CREATE INDEX idx_blog_posts_search ON blog_posts USING GIN(search_vector);
CREATE INDEX idx_blog_posts_tags ON blog_posts USING GIN(tags);
```

**TypeScript Type**:
```typescript
interface BlogPost {
  id: number
  slug: string
  title: string
  excerpt: string | null
  content: string
  authorId: number | null
  authorName: string
  category: BlogCategory | null
  tags: string[]
  featuredImageUrl: string | null
  published: boolean
  publishedAt: Date | null
  viewCount: number
  readingTimeMinutes: number | null
  createdAt: Date
  updatedAt: Date
}

type BlogCategory =
  | 'web-development'
  | 'mobile-development'
  | 'cloud-infrastructure'
  | 'ai-machine-learning'
  | 'best-practices'
  | 'case-studies'
  | 'thought-leadership'
```

**Validation Rules**:
- Slug: Auto-generated from title (kebab-case), unique, 1-255 chars
- Title: 10-500 characters
- Excerpt: 50-500 characters (optional, auto-generated from content if empty)
- Content: Minimum 100 characters, Markdown format
- Category: Must be one of BlogCategory enum
- Tags: Array of strings, 1-50 chars each, max 10 tags
- Reading time: Auto-calculated (words / 200 WPM)
- Featured image: Valid URL, prefer Next.js optimized images

**Relationships**:
- N:1 with users (author_id)

**Business Logic**:
- Slug auto-generation: `title.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '')`
- Published posts immutable slug
- Increment view_count on read (async, non-blocking)
- Search ranking by relevance + recency

### 3. case_studies

**Purpose**: Showcase client projects with detailed solutions and results

**Access Pattern**: List (filtered by industry/service), single case study by slug, search

```sql
CREATE TABLE case_studies (
  id SERIAL PRIMARY KEY,
  slug VARCHAR(255) UNIQUE NOT NULL,
  title VARCHAR(500) NOT NULL,
  client_name VARCHAR(255) NOT NULL,
  client_industry VARCHAR(100) NOT NULL,
  service_types TEXT[] NOT NULL,  -- Multiple services can apply
  challenge TEXT NOT NULL,
  solution TEXT NOT NULL,
  results_metrics JSONB,  -- Flexible structure for different metrics
  technologies TEXT[],
  project_duration VARCHAR(100),
  team_size INTEGER,
  featured_image_url TEXT,
  gallery_images TEXT[],
  testimonial_quote TEXT,
  testimonial_author VARCHAR(255),
  testimonial_role VARCHAR(255),
  published BOOLEAN DEFAULT false,
  published_at TIMESTAMP,
  display_order INTEGER DEFAULT 0,
  created_by INTEGER REFERENCES users(id) ON DELETE SET NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_case_studies_slug ON case_studies(slug);
CREATE INDEX idx_case_studies_published ON case_studies(published, display_order, published_at DESC);
CREATE INDEX idx_case_studies_industry ON case_studies(client_industry) WHERE published = true;
CREATE INDEX idx_case_studies_services ON case_studies USING GIN(service_types);
```

**TypeScript Type**:
```typescript
interface CaseStudy {
  id: number
  slug: string
  title: string
  clientName: string
  clientIndustry: IndustryType
  serviceTypes: ServiceType[]
  challenge: string
  solution: string
  resultsMetrics: ResultsMetric[]
  technologies: string[]
  projectDuration: string | null
  teamSize: number | null
  featuredImageUrl: string | null
  galleryImages: string[]
  testimonialQuote: string | null
  testimonialAuthor: string | null
  testimonialRole: string | null
  published: boolean
  publishedAt: Date | null
  displayOrder: number
  createdBy: number | null
  createdAt: Date
  updatedAt: Date
}

type IndustryType =
  | 'healthcare'
  | 'finance'
  | 'retail'
  | 'manufacturing'
  | 'education'
  | 'government'

type ServiceType =
  | 'custom-software'
  | 'web-development'
  | 'mobile-apps'
  | 'cloud-solutions'
  | 'ai-integration'
  | 'consulting'

interface ResultsMetric {
  label: string
  value: string | number
  icon?: string
}

// Example results_metrics JSON:
// [
//   { "label": "Performance Improvement", "value": "3x faster", "icon": "speed" },
//   { "label": "Cost Reduction", "value": "40%", "icon": "savings" },
//   { "label": "User Growth", "value": "+250%", "icon": "users" }
// ]
```

**Validation Rules**:
- Title: 10-500 characters
- Client name: 2-255 characters
- Industry: Must be one of IndustryType
- Service types: At least 1, max 6 services
- Challenge: 100-2000 characters
- Solution: 100-5000 characters
- Technologies: Array of strings, matches tech stack
- Display order: Used for homepage featured cases (0 = highest priority)

**Relationships**:
- N:1 with users (created_by)

**Business Logic**:
- Display order determines homepage showcase
- Gallery images stored in Next.js /public/images/case-studies/{slug}/
- Testimonials can be extracted and shown separately

### 4. contact_submissions

**Purpose**: Store contact form submissions with ICO-compliant retention

**Access Pattern**: Admin review, export, retention cleanup

```sql
CREATE TABLE contact_submissions (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL,
  company VARCHAR(255),
  service_interest VARCHAR(100) NOT NULL,
  budget_range VARCHAR(50) NOT NULL,
  timeline VARCHAR(50) NOT NULL,
  project_details TEXT NOT NULL,
  gdpr_consent BOOLEAN NOT NULL DEFAULT false,
  ip_address INET,
  user_agent TEXT,
  status VARCHAR(50) DEFAULT 'new',
  notes TEXT,
  assigned_to INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  retention_until TIMESTAMP DEFAULT (NOW() + INTERVAL '2 years'),
  contacted_at TIMESTAMP,
  deleted_at TIMESTAMP  -- Soft delete for GDPR requests
);

CREATE INDEX idx_contact_submissions_status ON contact_submissions(status, created_at DESC);
CREATE INDEX idx_contact_submissions_retention ON contact_submissions(retention_until);
CREATE INDEX idx_contact_submissions_email ON contact_submissions(email);
```

**TypeScript Type**:
```typescript
interface ContactSubmission {
  id: number
  name: string
  email: string
  company: string | null
  serviceInterest: ServiceType
  budgetRange: BudgetRange
  timeline: Timeline
  projectDetails: string
  gdprConsent: boolean
  ipAddress: string | null
  userAgent: string | null
  status: SubmissionStatus
  notes: string | null
  assignedTo: number | null
  createdAt: Date
  retentionUntil: Date
  contactedAt: Date | null
  deletedAt: Date | null
}

type BudgetRange = '<50k' | '50k-100k' | '100k-250k' | '250k+'
type Timeline = 'urgent' | '1-3-months' | '3-6-months' | '6+ months'
type SubmissionStatus = 'new' | 'in-progress' | 'contacted' | 'qualified' | 'converted' | 'closed'
```

**Validation Rules**:
- Name: 2-255 characters
- Email: Valid email format
- Project details: 50-5000 characters
- GDPR consent: Must be true
- Retention period: 2 years from submission (ICO compliance)
- Status transitions: new → in-progress → contacted → {qualified|closed}

**Relationships**:
- N:1 with users (assigned_to, optional)

**Business Logic**:
- Automatic email sent on creation (FR-006)
- Retention cleanup job runs monthly
- GDPR delete: Set deleted_at, anonymize PII fields
- IP and User Agent captured for security/spam prevention

**Privacy Compliance** (ICO/GDPR):
```sql
-- Monthly cleanup job
DELETE FROM contact_submissions
WHERE retention_until < NOW()
  AND deleted_at IS NULL;

-- GDPR right to erasure
CREATE FUNCTION gdpr_delete_submission(submission_id INTEGER)
RETURNS VOID AS $$
BEGIN
  UPDATE contact_submissions
  SET
    email = 'deleted@privacy.local',
    name = 'DELETED',
    company = NULL,
    project_details = 'DELETED BY USER REQUEST',
    ip_address = NULL,
    user_agent = NULL,
    deleted_at = NOW()
  WHERE id = submission_id;
END;
$$ LANGUAGE plpgsql;
```

### 5. testimonials

**Purpose**: Client feedback and satisfaction ratings

**Access Pattern**: List for homepage/about page, filtered by service

```sql
CREATE TABLE testimonials (
  id SERIAL PRIMARY KEY,
  client_name VARCHAR(255) NOT NULL,
  client_company VARCHAR(255) NOT NULL,
  client_role VARCHAR(255),
  quote TEXT NOT NULL,
  rating INTEGER CHECK (rating >= 1 AND rating <= 5),
  service_related VARCHAR(100),
  case_study_id INTEGER REFERENCES case_studies(id) ON DELETE SET NULL,
  avatar_url TEXT,
  featured BOOLEAN DEFAULT false,
  display_order INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_testimonials_featured ON testimonials(featured, display_order);
CREATE INDEX idx_testimonials_service ON testimonials(service_related);
```

**TypeScript Type**:
```typescript
interface Testimonial {
  id: number
  clientName: string
  clientCompany: string
  clientRole: string | null
  quote: string
  rating: 1 | 2 | 3 | 4 | 5
  serviceRelated: ServiceType | null
  caseStudyId: number | null
  avatarUrl: string | null
  featured: boolean
  displayOrder: number
  createdAt: Date
  updatedAt: Date
}
```

**Validation Rules**:
- Client name: 2-255 characters
- Company: 2-255 characters
- Quote: 50-500 characters
- Rating: 1-5 (integer)
- Featured: Only 3-6 testimonials should be featured at once

**Relationships**:
- N:1 with case_studies (optional link)

**Business Logic**:
- 98% satisfaction rate calculated from all ratings (FR-004)
- Featured testimonials shown on homepage
- Display order controls carousel sequence

## Static Data (JSON Files)

These entities don't change frequently and are stored as JSON files for performance.

### services.json

```typescript
interface Service {
  id: string  // Kebab-case identifier
  title: string
  shortDescription: string
  fullDescription: string
  benefits: string[]
  process: ProcessStep[]
  technologies: string[]
  icon: string  // Icon name from lucide-react
  featuredImage: string
  caseStudyIds: number[]  // Links to case_studies
}

interface ProcessStep {
  title: string
  description: string
  icon: string
}

// Example:
{
  "id": "custom-software",
  "title": "Custom Software Development",
  "shortDescription": "Tailored solutions for unique business challenges",
  "fullDescription": "We build custom software...",
  "benefits": [
    "Perfectly aligned with your business processes",
    "Scalable architecture",
    "Full ownership and control"
  ],
  "process": [
    {
      "title": "Discovery",
      "description": "Requirements gathering and analysis",
      "icon": "search"
    },
    // ...
  ],
  "technologies": ["Next.js", "React", "Node.js", "PostgreSQL"],
  "icon": "code",
  "featuredImage": "/images/services/custom-software.jpg",
  "caseStudyIds": [1, 3, 5]
}
```

### industries.json

```typescript
interface Industry {
  id: string
  name: string
  description: string
  challenges: string[]
  complianceStandards: string[]
  caseStudyIds: number[]
  icon: string
}

// Example:
{
  "id": "healthcare",
  "name": "Healthcare",
  "description": "HIPAA-compliant solutions for healthcare providers",
  "challenges": [
    "Patient data security",
    "Regulatory compliance",
    "System integration with EHRs"
  ],
  "complianceStandards": ["HIPAA", "HITECH", "FDA 21 CFR Part 11"],
  "caseStudyIds": [2, 7],
  "icon": "activity"
}
```

### technologies.json

```typescript
interface Technology {
  id: string
  name: string
  category: TechCategory
  proficiency: 'expert' | 'advanced' | 'proficient'
  description: string
  logo: string
  serviceIds: string[]  // Links to services
}

type TechCategory =
  | 'frontend'
  | 'backend'
  | 'database'
  | 'cloud'
  | 'mobile'
  | 'devops'
  | 'ai-ml'

// Example:
{
  "id": "nextjs",
  "name": "Next.js",
  "category": "frontend",
  "proficiency": "expert",
  "description": "React framework for production-grade applications",
  "logo": "/images/tech/nextjs.svg",
  "serviceIds": ["web-development", "custom-software"]
}
```

## Database Migrations

```sql
-- 001_initial_schema.sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE users (
  -- Schema from above
);

-- 002_blog_posts.sql
CREATE TABLE blog_posts (
  -- Schema from above
);

-- 003_case_studies.sql
CREATE TABLE case_studies (
  -- Schema from above
);

-- 004_contact_submissions.sql
CREATE TABLE contact_submissions (
  -- Schema from above
);

CREATE TABLE testimonials (
  -- Schema from above
);

-- 005_functions.sql
-- GDPR delete function, search functions, etc.
```

## Data Access Patterns

### Efficient Queries

**Homepage Data Loading**:
```typescript
// Single query to load homepage data
const homepageData = await Promise.all([
  query('SELECT * FROM blog_posts WHERE published = true ORDER BY published_at DESC LIMIT 3'),
  query('SELECT * FROM case_studies WHERE published = true ORDER BY display_order, published_at DESC LIMIT 6'),
  query('SELECT * FROM testimonials WHERE featured = true ORDER BY display_order LIMIT 6'),
  // Services, industries from JSON
])
```

**Blog List with Pagination**:
```typescript
const limit = 10
const offset = (page - 1) * limit

const [posts, countResult] = await Promise.all([
  query(`
    SELECT id, slug, title, excerpt, author_name, category, tags,
           featured_image_url, published_at, reading_time_minutes
    FROM blog_posts
    WHERE published = true
    ORDER BY published_at DESC
    LIMIT $1 OFFSET $2
  `, [limit, offset]),
  query('SELECT COUNT(*) FROM blog_posts WHERE published = true')
])

return {
  posts,
  total: countResult[0].count,
  page,
  totalPages: Math.ceil(countResult[0].count / limit)
}
```

**Search Across Content**:
```typescript
const searchQuery = to_tsquery('english', queryString)

const [blogResults, caseStudyResults] = await Promise.all([
  query(`
    SELECT id, slug, title, excerpt,
           ts_rank(search_vector, $1) as rank,
           ts_headline('english', content, $1) as snippet
    FROM blog_posts
    WHERE search_vector @@ $1 AND published = true
    ORDER BY rank DESC
    LIMIT 10
  `, [searchQuery]),
  query(`
    SELECT id, slug, title, challenge,
           ts_rank(to_tsvector('english', title || ' ' || challenge || ' ' || solution), $1) as rank
    FROM case_studies
    WHERE to_tsvector('english', title || ' ' || challenge || ' ' || solution) @@ $1
      AND published = true
    ORDER BY rank DESC
    LIMIT 10
  `, [searchQuery])
])
```

## Data Integrity Rules

1. **Referential Integrity**:
   - Foreign keys with ON DELETE SET NULL (preserve content if user deleted)
   - No cascading deletes (soft delete preferred)

2. **Constraints**:
   - Unique slugs enforced at database level
   - Email uniqueness for users
   - Check constraints for ratings (1-5)
   - NOT NULL for required fields

3. **Timestamps**:
   - Always store in UTC
   - Auto-update `updated_at` via trigger or application code
   - Immutable `created_at`

4. **Soft Deletes**:
   - Use `deleted_at` timestamp instead of hard deletes
   - Queries filter `WHERE deleted_at IS NULL`
   - GDPR requests anonymize data before soft delete

5. **Data Retention**:
   - Contact submissions: 2 years (ICO compliance)
   - Blog posts: Indefinite (can be archived)
   - User data: Until account deleted + grace period

## Performance Considerations

1. **Indexes**:
   - All foreign keys indexed
   - Composite indexes for common query patterns
   - GIN indexes for full-text search
   - Partial indexes for filtered queries

2. **Denormalization**:
   - `author_name` in blog_posts (avoid JOIN on every query)
   - Service/industry data in JSON files (static, read-heavy)

3. **Caching Strategy**:
   - Static data: Bundled at build time
   - Blog list: Cache-Control headers (revalidate on publish)
   - Case studies: Same as blog
   - Contact submissions: No caching (always fresh)

4. **Query Optimization**:
   - Use EXPLAIN ANALYZE for slow queries
   - Limit SELECT columns to needed fields
   - Paginate large result sets
   - Use connection pooling (pg Pool)

## Type Safety

All database types exported from `types/database.ts`:
```typescript
export type {
  User,
  UserProfile,
  BlogPost,
  BlogCategory,
  CaseStudy,
  IndustryType,
  ServiceType,
  ResultsMetric,
  ContactSubmission,
  BudgetRange,
  Timeline,
  SubmissionStatus,
  Testimonial,
  Service,
  Industry,
  Technology,
  TechCategory
}
```

---

**Data Model Complete** - Ready for contract generation (API specifications).
